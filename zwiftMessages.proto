syntax="proto3";


message PlayerState {
    int32 id = 1;
    int64 worldTime = 2;
    int32 distance = 3;
    int32 roadTime = 4;
    int32 laps = 5;
    int32 speed = 6;
    int32 roadPosition = 8;
    int32 cadenceUHz = 9;
    int32 heartrate = 11;
    int32 power = 12;
    int64 heading = 13;
    int32 lean = 14;
    int32 climbing = 15;
    int32 time = 16;
    int32 f19 = 19;
    int32 f20 = 20;
    int32 progress = 21;
    int64 customisationId = 22;
    int32 justWatching = 23;
    int32 calories = 24;
    float x = 25;
    float altitude = 26;
    float y = 27;
    int32 watchingAthleteId = 28;
    int32 groupId = 29;
    int64 sport = 31;
    float f34 = 34;  // actual distance moved included lateral movement
    int32 f35 = 35;
    int32 f38 = 38;
}

message ClientToServer {
    int32 connected = 1;
    int32 athlete_id = 2;
    int64 world_time = 3;
    int32 seqno = 4;
    PlayerState state = 7;
    int64 tag8 = 8;
    int64 tag9 = 9;
    int64 last_update = 10;
    int64 tag11 = 11;
    int64 last_player_update = 12;
}

message PlayerUpdate {
    int64 tag1 = 1;
    int32 tag2 = 2;
    enum PayloadType {
        UNSET = 0;
        Payload2 = 2;
        TimeSync = 3;
        RideOn = 4;
        ChatMessage = 5;
        RouteTBD = 6;
        PlayerEnteredWorld = 105;
    }
    PayloadType payloadType = 3;
    bytes payload = 4;
    int64 tag5 = 5;
    int64 tag6 = 6;
    int64 tag7 = 7;
    int64 tag8 = 8;
    int64 tag9 = 9;
    int64 tag11 = 11;
    int64 tag12 = 12;
    uint64 tag14_ts_from_unknown_XXX = 14;
    int64 tag15 = 15;
}

message PlayerEnteredWorld {
    int64 f1 = 1;
    int32 athlete_id = 2;
    int32 f3 = 3;
    int64 f4 = 4; // int32?
    //int64 f5 = 5; 
    sint64 f5 = 5;  // TESTING : seen huge negative numbers ("-9223372031499258613") with int64 Hmm , try this? XXX
    int64 f6 = 6; // int32?
    string firstName = 7;
    string lastName = 8;
    //int64 f9 = 9;  always seems like a value of "207270651460"
    sint64 f9 = 9;  // TESTING
    int64 f11 = 11;
    int32 f12 = 12;
    int32 weight = 13; // grams
    int32 f14 = 14;
    int32 f15 = 15;
    int32 f16 = 16;
    string date_of_unknown_XXX = 17;
    int32 f19 = 19;
}

message ChatMessage {
    int32 athlete_id = 1;
    int32 to_athlete_id = 2; // 0 if public message
    int32 f3 = 3; // always value 1 ?
    string firstName = 4;
    string lastName = 5;
    string message = 6;
    string avatar = 7;
    int32 countryCode = 8;
    int32 eventSubgroup = 11;
}

message RideOn {
    int32 athlete_id = 1;
    int32 to_athlete_id = 2;
    string firstName = 3;
    string lastName = 4;
    int32 countryCode = 5;
}

message Payload2 {
    int32 f1 = 1;
    int64 f2 = 2;
}

message TimeSync { 
    int32 f1 = 1;
    int64 f2 = 2; // worldtime ?
    int32 f3 = 3;
}

message RouteTBD {
    int64 f1 = 1; // varint
    int64 f2 = 2; // varint
    string route_or_world = 3; // ldelim
    string some_sort_of_quote_or_desc = 4; // ldelim
    uint64 ts_of_unknown = 5; // varint
    fixed32 f7 = 7; // fixed32 maybe float
    int64 f8 = 8; // varint
    string url = 12; // ldelim
    int64 ttl_or_expire_maybe = 13; // varint
    int64 f14 = 14; // varint
    int64 f17 = 17; // varint
    int64 f18 = 18; // varint
    int64 f19 = 19; // varint
    int64 f22 = 22; // varint
    int64 f23 = 23; // varint
    int64 f24 = 24; // varint
    int64 f25 = 25; // varint
    int64 f27 = 27; // varint
    int64 f28 = 28; // varint
    int64 f29 = 29; // varint
}

message EventPositions {
    int32 position = 1;
    message EventAthletePosition {
        int32 athlete_id = 1;
        // ?? float distance_covered = 2; 
    }
    repeated EventAthletePosition eventAthletePosition = 4;
    int32 num_athletes = 116;
}

message ServerToClient {
    int32 tag1 = 1;
    int32 athlete_id = 2;
    int64 world_time = 3;
    int32 seqno = 4;
    repeated PlayerState player_states = 8;
    repeated PlayerUpdate player_updates = 9;
    int64 tag11 = 11;
    string local_ip = 12;
    int64 tag15 = 15;
    int64 tag17 = 17;
    int32 num_msgs = 18;
    int32 msgnum = 19;
    EventPositions event_positions = 23;
    Server1 servers1 = 24;
    Server2 servers2 = 25;
}

message ServerAddress {
    int32 f1 = 1;
    int32 f2 = 2;
    string ip = 3;
    int32 f4 = 4;
    fixed32 f5 = 5;
    fixed32 f6 = 6;
}

message ServerPool {
    int32 f1 = 1;
    int32 f2 = 2;
    repeated ServerAddress addresses = 3;
    int32 f4 = 4;
}

message Server2 {
    repeated ServerPool pool = 1;
    int32 f2 = 2;
}

message Server1 {
    repeated ServerAddress addresses = 1;
    int32 f2 = 2;
    int32 f3 = 3;
    int32 f4 = 4;
}

message WorldAttributes {
    int32 world_id = 1;
    string name = 2;
    int64 tag3 = 3;
    int64 tag5 = 4;
    int64 world_time = 6;
    int64 clock_time = 7;
}

message WorldAttribute {
    int64 world_time = 2;
}

message EventSubgroupProtobuf {
    int32 id = 1;
    string name = 2;
    int32 rules = 8;
    int32 route = 22;
    int32 laps = 25;
    int32 startLocation = 29;
    int32 label = 30;
    int32 paceType = 31;
    int32 jerseyHash = 36;
}

message AthleteAttributes {
    int32 f2 = 2;
    int32 f3 = 3;
    message AttributeMessage {
        int32 myId = 1;
        int32 theirId = 2;
        string firstName = 3;
        string lastName = 4;
        int32 countryCode = 5;
    }
    AttributeMessage attributeMessage = 4;
    int32 theirId = 10;
    int32 f13 = 13;
}
